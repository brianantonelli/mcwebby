<!DOCTYPE html> 
<html> 
<head> 
	<title>Minecraft Server Status</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
	<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
</head> 
<body> 

<div data-role="page">

	<div data-role="header">
		<h1>MC Status</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<h2>Server Status: <span id="serverStatus"></span></h2>
		<h2>Users Online: <span id="userCount"></span></h2>
		<ul data-role="listview" data-inset="true" id="users">
		</ul>
		<p>Last Backup: <span id="lastBackup"></span></p>
	</div><!-- /content -->

</div><!-- /page -->

<script type="text/javascript">
	(function($){
		var userCount = 0,
			loadData = function(){
				$.ajax('/online.json').done(function(data){
					userCount = data.onlineCount;
					$('#userCount').text([data.onlineCount, data.maxOnline].join('/'));
					$('#lastBackup').text(data.lastBackup.split('storage/')[1]);
					$('#serverStatus').text(data.status ? 'Online' : 'Offline').css('color', data.status ? 'green' : 'red');
					var users = $('#users').empty();
					$(data.userList).each(function(i, user){
						users
							.append($('<li/>')
								.text(user)
								.append($('<img src="block.jpg"/>')
									.addClass('ui-li-icon')));
					});

					users.listview('refresh');
				});			
			},
			start = function(){
				loadData();
				window.setTimeout(loadData, 5000);
			};

		$(document).ready(start);
	})(jQuery);
</script>


</body>
</html>
